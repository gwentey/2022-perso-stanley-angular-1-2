
<div class="modal-header">
  <h4 class="modal-title">Ajouter une production</h4>
  <button
    type="button"
    class="btn-close"
    aria-label="Close"
    (click)="activeModal.dismiss()"
  ></button>
</div>
<div class="modal-body">
  <!-- step 1 -->
  <div *ngIf="step == 1 || step == 0" class="my-2">
    <div class="d-flex justify-content-center align-items-center mb-2">
      <h5>
        <img src="assets/img/search.png" height="30px" /> Nom du produit
        <img src="assets/img/search.png" height="30px" />
      </h5>
    </div>
    <input
      id="typeahead-basic"
      type="text"
      placeholder="Saisissez le nom du produit"
      class="form-control mb-3"
      [(ngModel)]="choixProduit"
      [ngbTypeahead]="search"
    />
  </div>

  <!-- step 2 -->
  <div *ngIf="step == 2" class="my-2">
    <div class="d-flex justify-content-center align-items-center mb-2">
      <h5>
        <img src="assets/img/cook.png" height="30px" /> Un produit a été trouvé
        <img src="assets/img/cook.png" height="30px" />
      </h5>
    </div>
    <p>
      <strong
        >Un produit similaire a été trouvé :
        <span class="text-primary">{{ produitFound.nom }}</span> !</strong
      >
    </p>

    <div class="row">
      <div class="col-8">
        <strong
          >Composition :
          <div *ngFor="let composition of produitFound.composition">
            <span class="text-primary">-{{ composition.nom }}</span>
          </div>
        </strong>
      </div>

      <div class="col">
        <strong
          >Prix : <span class="text-primary">{{ produitFound.prix }}</span> €
          /unité
        </strong>
      </div>
    </div>
  </div>

  <!-- step 3 -->
  <div *ngIf="step == 3" class="my-2">
    <div class="d-flex justify-content-center align-items-center mb-2">
      <h5>
        <img src="assets/img/search.png" height="30px" /> Création d'un produit
        <img src="assets/img/search.png" height="30px" />
      </h5>
    </div>

    <strong>
      <div class="mb-3">
        <label for="nomProduit" class="form-label">Nom du produit</label>
        <input type="text" placeholder="Saisir nom du produit" class="form-control" id="nomProduit" />
      </div>
      <hr />
      <div class="mb-3">
        <select class="form-select">
          <option selected>Sélectionner la famille du produit</option>
          <option
            *ngFor="let familleProduit of listeFamilleProduits"
            value="{{ familleProduit.id }}"
          >
            {{ familleProduit.nom }}
          </option>
        </select>
      </div>
      <div class="mb-3">
        <select class="form-select">
          <option selected>Sélectionner l'unité de produit</option>
          <option
            *ngFor="let uniteeProduit of listeUniteeProduits"
            value="{{ uniteeProduit.id }}"
          >
            {{ uniteeProduit.nom }}
          </option>
        </select>
      </div>
    </strong>
  </div>

  <!-- step 4 -->
  <div *ngIf="step == 4" class="my-2">
    <div class="d-flex justify-content-center align-items-center mb-2">
      <h5>
        <img src="assets/img/search.png" height="30px" /> Composition du produit
        <img src="assets/img/search.png" height="30px" />
      </h5>
    </div>

    <tagify
      id="composition"
      name="composition"
      [settings]="settings"
      [whitelist]="whitelist$"
      [(ngModel)]="composition"
    >
    </tagify>
  </div>


  <!-- step 5 -->
  <div *ngIf="step == 5" class="my-2">
    <div class="d-flex justify-content-center align-items-center mb-2">
      <h5>
        <img src="assets/img/search.png" height="30px" /> Composition du produit
        <img src="assets/img/search.png" height="30px" />
      </h5>
    </div>

    <div *ngFor="let compo of compositionChoix" class="input-group mb-3">
      <div class="input-group-prepend w-50">
        <span class="input-group-text w-100" style="font-size: smaller;">{{ compo.nom | truncate:59 }}</span>
      </div>
      <input name="qt[]" (change)="calculComposition()" type="number" class="form-control" style="width: 37px;" value="1">
      <div class="input-group-prepend">
      <span class="input-group-text" style="width: 78px">{{ compo.unitee.nom }}</span>
    </div>

      <input name="pu[]" (change)="calculComposition()" type="number" class="form-control" value="{{ compo.prix }}">
      <div class="input-group-prepend">
      <span class="input-group-text">P.U</span>
    </div>

    <input name="prix[]" type="text" class="form-control" disabled>
    <div class="input-group-prepend">
    <span class="input-group-text">€</span>
  </div>
    </div>

<div class="d-flex justify-content-end mt-4">
    <div class="input-group w-25">
      <input id="prixtotal" type="text" class="form-control" disabled>
      <span class="input-group-text">€</span>
    </div>
  </div>

  </div>

  <!-- step 6 -->
  <div *ngIf="step == 6" class="my-2">
    <div class="d-flex justify-content-center align-items-center mb-2">
      <h5>
        <img src="assets/img/search.png" height="30px" /> Information production
        <img src="assets/img/search.png" height="30px" />
      </h5>
    </div>

    <strong>
      <div class="row">
        <div class="col-7">
          <div class="mb-3">
            <label for="nomProduit" class="form-label">Date création</label>
            <div class="input-group">
              <input
                class="form-control"
                placeholder="dd-mm-YYYY"
                name="dp"
                [(ngModel)]="dateFabrication"
                ngbDatepicker
                #d="ngbDatepicker"
              />
              <button
                class="btn btn-outline-secondary calendar"
                (click)="d.toggle()"
                type="button"
              ></button>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="mb-3">
            <label for="nomProduit" class="form-label"
              >Conservation en jour</label
            >
            <input type="number" class="form-control" id="nomProduit" />
          </div>
        </div>
      </div>

      <hr />
      <div class="mb-3">
        <select class="form-select">
          <option selected>Sélectionner l'atelier</option>
          <option
            *ngFor="let familleProduit of listeFamilleProduits"
            value="{{ familleProduit.id }}"
          >
            {{ familleProduit.nom }}
          </option>
        </select>
      </div>
      <div class="mb-3">
        <select class="form-select">
          <option selected>Sélectionner la classe</option>
          <option
            *ngFor="let uniteeProduit of listeUniteeProduits"
            value="{{ uniteeProduit.id }}"
          >
            {{ uniteeProduit.nom }}
          </option>
        </select>
      </div>
      <div class="mb-3">
        <select class="form-select">
          <option selected>Sélectionner le professeur</option>
          <option
            *ngFor="let familleProduit of listeFamilleProduits"
            value="{{ familleProduit.id }}"
          >
            {{ familleProduit.nom }}
          </option>
        </select>
      </div>
      <hr />
      <div class="row">
        <div class="col">
          <div class="mb-3">
            <label for="conditionnement" class="form-label">Conditionnement</label>
              <input type="number" class="form-control" id="conditionnement" />
          </div>
        </div>
        <div class="col">
          <div class="mb-3">
            <label for="quantite" class="form-label"
              >Quantité</label
            >
            <input type="number" class="form-control" id="quantite" />
          </div>
        </div>
      </div>
    </strong>
  </div>

  <!-- progress bar -->
  <app-progress-bar [step]="step"></app-progress-bar>
</div>
<div class="modal-footer">
  <div *ngIf="step != 2">
    <a
      (click)="etapeSuivante()"
      class="d-none d-sm-inline-block btn btn-sm btn-success shadow-sm"
    >
      <i class="fas fa-arrow-right fa-sm text-white-50 me-1"> </i>Continuer</a
    >
  </div>

  <div *ngIf="step == 2">
    <a
      (click)="etapeSuivante(1)"
      class="d-none d-sm-inline-block btn btn-sm btn-success shadow-sm me-2"
    >
      <i class="fas fa-check fa-sm text-white-50 me-1"> </i>C'est bien ce
      produit</a
    >
    <a
      (click)="etapeSuivante()"
      class="d-none d-sm-inline-block btn btn-sm btn-danger shadow-sm"
    >
      <i class="fas fa-xmark fa-sm text-white-50 me-1"> </i>Non, je veux créer
      un nouveau produit</a
    >
  </div>
</div>
